<!DOCTYPE html>
<html>
<head>
<title>My Own Score Record</title>
<style>
body { font-size: 18px; }
table { width: 90%; border-collapse: collapse; font-size: 16px; }
th, td { border: 1px solid black; padding: 12px; }
th { text-align: left; }
input[type="text"] { font-size: 16px; padding: 8px; width: 100%; box-sizing: border-box; }
button { font-size: 16px; padding: 8px 12px; }
img { max-width: 100px; max-height: 100px; display: block; margin-top: 5px; } 
.hidden { display: none; }
</style>
</head>
<body>

<input type="text" id="searchInput" placeholder="Search..." onkeyup="searchTable()">

<table>
  <thead>
    <tr>
      <th>Assessment Name</th>
      <th>Score</th>
      <th>Image</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<input type="text" id="newCol1" placeholder="Column 1">
<input type="text" id="newCol2" placeholder="Column 2">
<button onclick="addRow()">Add Row</button>

<script>
  const pageID = window.location.pathname;
  const storageKey = `tableData_${pageID}`;
  let data = JSON.parse(localStorage.getItem(storageKey)) || [];

  function updateLocalStorage() {
    localStorage.setItem(storageKey, JSON.stringify(data));
  }

  function updateData(rowIndex, colIndex, value) {
    data[rowIndex][colIndex] = value;
    updateLocalStorage();
    renderTable();
  }

  function deleteRow(rowIndex) {
    data.splice(rowIndex, 1);
    updateLocalStorage();
    renderTable();
  }

  function addRow() {
    data.push(["", "", ""]);
    updateLocalStorage();
    renderTable();
  }

  function renderTable() {
    requestAnimationFrame(() => {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';

      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filteredData = data.filter(row => row.some(cell => cell && cell.toLowerCase().includes(searchTerm)));

      filteredData.forEach((row, rowIndex) => {
        const newRow = tbody.insertRow();
        row.forEach((cell, colIndex) => {
          const cellElement = newRow.insertCell();
          if (colIndex === 2) { // Image column
            const img = document.createElement('img');
            img.src = cell || 'https://via.placeholder.com/100';
            img.alt = 'Uploaded Image';
            cellElement.appendChild(img);

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.classList.add('hidden');
            fileInput.onchange = (event) => {
              const file = event.target.files[0];
              const reader = new FileReader();
              reader.onload = (e) => {
                updateData(rowIndex, colIndex, e.target.result);
              };
              reader.readAsDataURL(file);
            };

            const chooseImageButton = document.createElement('button');
            chooseImageButton.textContent = 'Choose Image';
            chooseImageButton.onclick = () => fileInput.click();

            cellElement.appendChild(fileInput);
            cellElement.appendChild(chooseImageButton);
          } else {
            const input = document.createElement('input');
            input.type = 'text';
            input.value = cell;
            input.addEventListener('change', () => updateData(rowIndex, colIndex, input.value));
            cellElement.appendChild(input);
          }
        });

        const actionsCell = newRow.insertCell();
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = () => deleteRow(rowIndex);
        actionsCell.appendChild(deleteButton);
      });
    });
  }

  function searchTable() {
    renderTable();
  }

  renderTable();
</script>

</body>
</html>
